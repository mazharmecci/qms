<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>QMS - Instruments</title>

  <!-- Font & Quill -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: #f5f7fa;
      margin: 0;
      padding: 0;
    }

    header {
      background: #0d6efd;
      color: white;
      padding: 0.75rem 1.5rem;
    }

    .header-inner {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .back-btn {
      border: none;
      background: rgba(255,255,255,0.12);
      color: #ffffff;
      padding: 0.45rem 0.9rem;
      border-radius: 999px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.9rem;
    }

    .header-title {
      flex: 1;
      text-align: center;
      font-weight: 600;
      font-size: 1.5rem;
    }

    .container {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 2rem;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    .top-bar h2 {
      color: #0d6efd;
      margin: 0;
    }
    .top-bar button {
      background: #0d6efd;
      color: white;
      border: none;
      padding: 0.6rem 1rem;
      border-radius: 8px;
      cursor: pointer;
    }

    form {
      display: none;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-bottom: 2rem;
      margin-top: 1rem;
    }
    form.active {
      display: grid;
    }
    form input,
    form select,
    form button {
      padding: 0.8rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 0.95rem;
    }

    #detailsEditor {
      grid-column: span 2;
      height: 150px;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    form button[type="submit"] {
      grid-column: span 2;
      background: #0d6efd;
      color: white;
      border: none;
      cursor: pointer;
    }

    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 8px; /* 1-line style gap between rows */
      margin-top: 1rem;
    }

    table thead th {
      padding: 0.8rem;
      background: #f0f4f8;
      color: #333;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    table tbody tr {
      background: #ffffff;
      box-shadow: 0 1px 4px rgba(0,0,0,0.04);
    }

    table td {
      padding: 0.8rem;
      border-top: 1px solid #eee;
      border-bottom: 1px solid #eee;
      vertical-align: top;
    }

    table tbody tr td:first-child {
      border-left: 1px solid #eee;
      border-radius: 8px 0 0 8px;
    }

    table tbody tr td:last-child {
      border-right: 1px solid #eee;
      border-radius: 0 8px 8px 0;
    }

    .actions {
      white-space: nowrap;
    }

    .actions button {
      margin-right: 0.5rem;
      padding: 0.4rem 0.8rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85rem;
    }
    .edit-btn {
      background: #ffc107;
      color: #000;
    }
    .delete-btn {
      background: #dc3545;
      color: white;
    }

    .pagination {
      margin-top: 1rem;
      text-align: center;
    }
    .pagination button {
      margin: 0 0.5rem;
      padding: 0.4rem 0.8rem;
      border: none;
      border-radius: 6px;
      background: #0d6efd;
      color: white;
      cursor: pointer;
    }

    .collapse-toggle {
      cursor: pointer;
      color: #0d6efd;
      font-weight: 600;
      font-size: 0.9rem;
      user-select: none;
      margin-bottom: 0.25rem;
    }
    .details-content {
      display: none;
      font-size: 0.9rem;
    }

    .price-cell {
      font-weight: 600;
      color: #333;
      white-space: nowrap;
    }
  </style>
</head>
<body>
  <!-- Header with Back button -->
  <header>
    <div class="header-inner">
      <button type="button" class="back-btn" onclick="goBack()">
        ← Back
      </button>
      <div class="header-title">QMS - Instruments</div>
    </div>
  </header>

  <div class="container">
    <div class="top-bar">
      <h2>Instrument Master</h2>
      <button onclick="toggleForm()">Add Instrument</button>
    </div>

    <form id="instrumentForm">
      <input type="text" id="description" placeholder="Instrument Description" required>

      <div id="detailsEditor"></div>

      <input type="text" id="origin" placeholder="Country Of Origin">
      <input type="text" id="catalog" placeholder="Catalog Reference">

      <input type="text" id="hsn" placeholder="HSN Code (1234 5678)" maxlength="9">

      <select id="additional">
        <option value="">Includes Additional Item?</option>
        <option value="Yes">Yes</option>
        <option value="No">No</option>
      </select>

      <select id="configuration">
        <option value="">Includes Configuration?</option>
        <option value="Yes">Yes</option>
        <option value="No">No</option>
      </select>

      <input type="text" id="price" placeholder="Basic Price">

      <input type="text" id="gstType" placeholder="GST Type">
      <input type="number" id="gstPercent" placeholder="GST %">

      <button type="submit">Save Instrument</button>
    </form>

    <table id="instrumentTable">
      <thead>
        <tr>
          <th>Description</th>
          <th>Details</th>
          <th>Origin</th>
          <th>Catalog</th>
          <th>HSN</th>
          <th>Additional</th>
          <th>Config</th>
          <th>Price</th>
          <th>GST Type</th>
          <th>GST %</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="pagination">
      <button onclick="prevPage()">Prev</button>
      <span id="pageInfo"></span>
      <button onclick="nextPage()">Next</button>
    </div>
  </div>

  <!-- Quill library -->
  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
  <script>
    const form = document.getElementById('instrumentForm');
    const tableBody = document.querySelector('#instrumentTable tbody');
    const pageInfo = document.getElementById('pageInfo');
    const hsnInput = document.getElementById('hsn');
    const priceInput = document.getElementById('price');

    let instruments = [];
    let currentPage = 1;
    const pageSize = 10;
    let editIndex = null;

    // Initialize Quill editor
    const quill = new Quill('#detailsEditor', {
      theme: 'snow',
      placeholder: 'Enter instrument details...',
      modules: {
        toolbar: [
          ['bold', 'italic', 'underline'],
          [{ 'list': 'ordered' }, { 'list': 'bullet' }],
          [{ 'header': [1, 2, 3, false] }],
          ['link']
        ]
      }
    });

    function goBack() {
      if (window.history.length > 1) {
        window.history.back();
      } else {
        // Optional fallback
        // window.location.href = 'index.html';
      }
    }

    function toggleForm() {
      form.classList.toggle('active');
    }

    // HSN: allow digits only, format as 1234 5678
    hsnInput.addEventListener('input', () => {
      let digits = hsnInput.value.replace(/\D/g, '').slice(0, 8); // max 8 digits
      if (digits.length > 4) {
        digits = digits.slice(0, 4) + ' ' + digits.slice(4);
      }
      hsnInput.value = digits;
    });

    // Price: live formatting with ₹ and commas
    priceInput.addEventListener('input', () => {
      let digits = priceInput.value.replace(/[^\d]/g, '');
      if (!digits) {
        priceInput.value = '';
        return;
      }
      const num = parseInt(digits, 10);
      priceInput.value = '₹ ' + num.toLocaleString('en-IN');
    });

    function parsePriceValue(displayValue) {
      const digits = (displayValue || '').replace(/[^\d]/g, '');
      return digits ? parseInt(digits, 10) : 0;
    }

    form.addEventListener('submit', function(e) {
      e.preventDefault();

      const instrument = {
        description: document.getElementById('description').value,
        details: quill.root.innerHTML,
        origin: document.getElementById('origin').value,
        catalog: document.getElementById('catalog').value,
        hsn: hsnInput.value,
        additional: document.getElementById('additional').value,
        configuration: document.getElementById('configuration').value,
        price: parsePriceValue(priceInput.value),
        gstType: document.getElementById('gstType').value,
        gstPercent: document.getElementById('gstPercent').value
      };

      if (editIndex !== null) {
        instruments[editIndex] = instrument;
        editIndex = null;
      } else {
        instruments.push(instrument);
      }

      form.reset();
      quill.setContents([]);
      form.classList.remove('active');
      renderTable();
    });

    function formatPriceDisplay(value) {
      return '₹ ' + Number(value || 0).toLocaleString('en-IN');
    }

    function renderTable() {
      tableBody.innerHTML = '';

      const start = (currentPage - 1) * pageSize;
      const end = start + pageSize;
      const pageItems = instruments.slice(start, end);

      pageItems.forEach((inst, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${inst.description}</td>
          <td>
            <div class="collapse-toggle" onclick="toggleDetails(this)">
              Details
            </div>
            <div class="details-content">${inst.details}</div>
          </td>
          <td>${inst.origin}</td>
          <td>${inst.catalog}</td>
          <td>${inst.hsn}</td>
          <td>${inst.additional}</td>
          <td>${inst.configuration}</td>
          <td class="price-cell">${formatPriceDisplay(inst.price)}</td>
          <td>${inst.gstType}</td>
          <td>${inst.gstPercent}</td>
          <td class="actions">
            <button class="edit-btn" onclick="editInstrument(${start + index})">Edit</button>
            <button class="delete-btn" onclick="deleteInstrument(${start + index})">Delete</button>
          </td>
        `;
        tableBody.appendChild(row);
      });

      pageInfo.textContent =
        `Page ${currentPage} of ${Math.ceil(instruments.length / pageSize) || 1}`;
    }

    function toggleDetails(toggleEl) {
      const details = toggleEl.nextElementSibling;
      const isVisible = details.style.display === 'block';
      details.style.display = isVisible ? 'none' : 'block';
      toggleEl.textContent = isVisible ? 'Details' : 'Hide details';
    }

    function editInstrument(index) {
      const inst = instruments[index];

      document.getElementById('description').value = inst.description;
      document.getElementById('origin').value = inst.origin;
      document.getElementById('catalog').value = inst.catalog;
      hsnInput.value = inst.hsn;
      document.getElementById('additional').value = inst.additional;
      document.getElementById('configuration').value = inst.configuration;
      priceInput.value = formatPriceDisplay(inst.price);
      document.getElementById('gstType').value = inst.gstType;
      document.getElementById('gstPercent').value = inst.gstPercent;

      quill.root.innerHTML = inst.details;

      editIndex = index;
      form.classList.add('active');
    }

    function deleteInstrument(index) {
      instruments.splice(index, 1);

      const maxPage = Math.max(1, Math.ceil(instruments.length / pageSize));
      if (currentPage > maxPage) {
        currentPage = maxPage;
      }

      renderTable();
    }

    function nextPage() {
      if (currentPage * pageSize < instruments.length) {
        currentPage++;
        renderTable();
      }
    }

    function prevPage() {
      if (currentPage > 1) {
        currentPage--;
        renderTable();
      }
    }

    // Initial render
    renderTable();
  </script>
</body>
</html>
