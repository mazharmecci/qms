<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>QMS - Quote Repository</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family:'Inter',sans-serif; background:#f5f7fa; margin:0; }
    header { background:#0d6efd; color:#fff; padding:1rem 2rem; text-align:center; font-size:1.5rem; font-weight:600; }
    .container { max-width:1200px; margin:2rem auto; padding:2rem; background:#fff; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
    h2 { color:#0d6efd; margin-bottom:1rem; }
    table { width:100%; border-collapse:collapse; }
    table th, table td { padding:0.8rem; border-bottom:1px solid #ddd; text-align:left; }
    table th { background:#f0f4f8; }
    .actions button { margin-right:0.5rem; padding:0.4rem 0.8rem; border:none; border-radius:6px; cursor:pointer; }
    .view-btn { background:#0d6efd; color:#fff; }
    .delete-btn { background:#dc3545; color:#fff; }
    .quote-details { margin-top:1rem; padding:1rem; background:#f9fafc; border:1px solid #ddd; border-radius:8px; }
  </style>
</head>
<body>
<header>QMS - Quote Repository</header>
<div class="container">
  <h2>Saved Quotes</h2>
  <table id="quoteTable">
    <thead>
      <tr>
        <th>#</th>
        <th>Quote No</th>
        <th>Date</th>
        <th>Hospital</th>
        <th>Total Value (INR)</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <div id="quoteDetails"></div>
</div>

<script>
  const tableBody = document.querySelector('#quoteTable tbody');
  const detailsDiv = document.getElementById('quoteDetails');
  let quotes = JSON.parse(localStorage.getItem('quotes') || '[]');

  function renderTable() {
    tableBody.innerHTML = '';
    quotes.forEach((q, index) => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${index+1}</td>
        <td>${q.header.quoteNo||'-'}</td>
        <td>${q.header.quoteDate||'-'}</td>
        <td>${q.header.hospitalName||'-'}</td>
        <td>₹ ${q.summary.totalValue.toLocaleString('en-IN')}</td>
        <td class="actions">
          <button class="view-btn" onclick="viewQuote(${index})">View</button>
          <button class="delete-btn" onclick="deleteQuote(${index})">Delete</button>
        </td>
      `;
      tableBody.appendChild(row);
    });
  }

  function viewQuote(index) {
    const q = quotes[index];
    let lineItemsHTML = `
      <h3>Quote Details</h3>
      <p><strong>Quote No:</strong> ${q.header.quoteNo}</p>
      <p><strong>Date:</strong> ${q.header.quoteDate}</p>
      <p><strong>Hospital:</strong> ${q.header.hospitalName}</p>
      <hr>
      <h4>Line‑Item Breakdown</h4>
      <table style="width:100%; border-collapse:collapse; margin-bottom:1rem;">
        <thead>
          <tr style="background:#f0f4f8;">
            <th>Item</th><th>Code</th><th>Type</th><th style="text-align:right;">Price (INR)</th>
          </tr>
        </thead>
        <tbody>
    `;
    q.lineItems.forEach(li => {
      lineItemsHTML += `
        <tr>
          <td>${li.name}</td>
          <td>${li.code}</td>
          <td>${li.type}</td>
          <td style="text-align:right;">₹ ${li.price.toLocaleString('en-IN')}</td>
        </tr>
      `;
    });
    lineItemsHTML += `</tbody></table>
      <h4>Quote Summary</h4>
      <p><strong>Items Value Total INR:</strong> ₹ ${q.summary.itemsTotal.toLocaleString('en-IN')}</p>
      <p><strong>Special Discount:</strong> ₹ ${q.summary.discount.toLocaleString('en-IN')}</p>
      <p><strong>Price After Discount:</strong> ₹ ${q.summary.afterDiscount.toLocaleString('en-IN')}</p>
      <p><strong>Freight Costs:</strong> ${q.summary.freight}</p>
      <p><strong>GST @ ${q.summary.gstPercent}%:</strong> ₹ ${q.summary.gstAmount.toLocaleString('en-IN')}</p>
      <p><strong>Total Value INR:</strong> ₹ ${q.summary.totalValue.toLocaleString('en-IN')}</p>
      <p><strong>Round Off:</strong> ₹ ${q.summary.roundOff.toLocaleString('en-IN')}</p>
      <div style="margin-top:2rem; text-align:right; font-style:italic; color:#555;">
        <p>For ISTOS Medical Private Limited</p>
      </div>
    `;
    detailsDiv.innerHTML = `<div class="quote-details">${lineItemsHTML}</div>`;
  }

  function deleteQuote(index) {
    if (confirm('Are you sure you want to delete this quote?')) {
      quotes.splice(index,1);
      localStorage.setItem('quotes', JSON.stringify(quotes));
      renderTable();
      detailsDiv.innerHTML = '';
    }
  }

  renderTable();
</script>
</body>
</html>
